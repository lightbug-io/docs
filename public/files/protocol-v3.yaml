version: 3
limits:
  MAX_DATA_FIELD_LEN: 200 # As currently defined in Firmware
  MAX_HEADER_FILED_LEN: 20 # As currently defined in Firmware
groups:
  general:
    name: General
    description: "General messages"
  bootserver:
    hidden: true
    name: Bootserver
    description: "Device to Boot server communication"
  device-services:
    name: Device Services
    overview: true
    description: "Messages intended to control the device"
  device-ux:
    name: Device UX
    overview: true
    description: "Messages intended to control the device, specifically for user interface and interactions"
header:
  1:
    name: "Message ID"
    description: "ID that can be used by receiver to ACK, and client to track for various responses, or re-sends"
    type: "uintn"
  2:
    name: "Client ID"
    description: "ID of the client sending the message"
    type: "uintn"
  3:
    name: "Response to Message ID"
    description: "ID of the message that is being responded to"
    type: "uintn"
  4:
    name: "Message Status"
    description: "Status of the message. If omitted, assume OK?"
    type: "uintn"
    values:
      1:
        name: "OK"
        description: "Everything appears to be OK"
      2:
        name: "NOT_OK"
        description: "Something went wrong while processing the message"
  5:
    name: "Message Method"
    description: "Request a service to be perform an action"
    type : "uintn"
    values:
      1:
        name: "SET"
        description: "Set one or more values that are provided in the message payload"
      2:
        name: "GET"
        description: "Get one or more values that have their types provided in the message payload. If no payload types are provided, all available values are returned"
      3:
        name: "SUBSCRIBE"
        description: "Subscribe to a value or values. If no payload types are provided, all available values will be subscribed to. If a value changes, the service will send a message with the new value"
      4:
        name: "DO"
        description: "Perform an action."
  6:
    name: "Subscription interval"
    description: "Interval in ms. To be used with the SUBSCRIBE method"
    type: "uintn"
  10:
    name: "Forwarded For"
    description: "ID of the client sending the original message that is being forwarded. For LORA this is a device ID. For Main CPU, this is a link or module ID."
  11:
    name: "Forwarded RSSI"
    description: "RSSI of forwarded message"
  12:
    name: "Forwarded SNR"
    description: "SNR  of forwarded message"
  13:
    name: "Forwarding Type"
    description: "Type of forwarded or forwarding message"
    type: "uintn"
    values:
      1:
        name: "LORA Base Station" # Forwarded via a LORA base station
      2:
        name: "Main CPU" # Forwarded via the main CPU
  14:
    name: "Forward to"
    description: "ID of the client to forward the message to. For LORA this is (not yet implemented). For Main CPU, this is a link or module ID."
    type: "uintn"
  15:
    name: "Forward and use"
    description: "Should the message be forwarded and also used by the current client?"
    type: "uint8"
    values:
      0:
        name: "No (default)"
      1:
        name: "Yes"
messages:
  5:
    name: "ACK"
    description: "General ACK message"
    group: "general"
    data:
      1:
        name: "ACKed Type"
        description: "Type of previous message being ACKed"
        type: "uint16"
      2:
        name: "ACKed ID"
        description: "ID of previous message being ACKed, if provided in the original message header"
        type: "uintn"
  10:
    name: "Start"
    hidden: true
    group: "livelink"
  11:
    name: "Open"
    hidden: true
    group: "livelink"
  12:
    name: "Close"
    hidden: true
    group: "livelink"
  13:
    name: "Heartbeat"
    description: "A message to keep the connection alive. Arbitrary fields can be added in fields 200+"
    group: "general"
    data:
      4:
        name: "GSM Signal"
        description: "First byte is CSQ [0-31], 99 for unknown. Recommended to x4 to get a percentage. Byte 2 and 3 are uint16 LE network info."
        type: "bytes"
      5:
        name: "Firmware version"
        description: "Current Firmware version of the device"
        type: "uint16"
      6:
        name: "Battery percent"
        type: "uint8"
  14:
    name: "Livelink Config Update"
    hidden: true
    group: "livelink"
  15:
    name: "Livelink Position Data"
    hidden: true
    group: "livelink"
    data:
      1:
        name: "Timestamp"
        type: "uint64"
      2:
        name: "Latitude E7"
        type: "int32"
      3:
        name: "Longitude E7"
        type: "int32"
      4:
        name: "Altitude E3"
        type: "int32"
      5:
        name: "Accuracy cm"
        type: "uint16"
      6:
        name: "Course Over Ground E2"
        type: "uint16"
      7:
        name: "Speed E2"
        type: "uint16"
      8:
        name: "Number of Satellites"
        type: "uint8"
      9:
        name: "Average CN0"
        type: "uint8"
      10:
        name: "Position Type"
        type: "uint8"
        values:
          0:
            name: "invalid"
          1:
            name: "fixed"
          2:
            name: "RESERVED"
          3:
            name: "standalone"
          4:
            name: "rtkFloat"
          5:
            name: "rtkFix"
          6:
            name: "surveying"
      11:
        name: "Position Source"
        type: "uint8"
        values:
          0:
            name: "GPS"
          1:
            # DOESN'T MEANT RTK CORRECTED DATA, just coming from the rtk module
            name: "RTK"
  16:
    name: "Livelink Device Status"
    hidden: true
    group: "livelink"
  30:
    name: "Transmit Now"
    description: "Transmit data immediately"
    group: "device-services"
    data:
      1:
        name: "Search GPS"
        description: "0 = no, 1 = yes"
        type: "uint8"
      2:
        name: "Data"
        description: "can be up to 200 bytes"
        type: "bytes"
      3:
        name: "Retries"
        description: "0 - 10"
        type: "uint8"
      4:
        name: "Priority"
        description: "0 - 1"
        type: "uint8"
  31:
    name: "GSM CFUN"
    description: "GSM functionality control"
    group: "device-services"
    data:
      1:
        name: "Mode"
        description: "0 or 1"
        type: "uint8"
        values:
          0:
            name: "Lock OFF Mode"
          1:
            name: "Normal Mode"
      2:
        name: "Mode Duration"
        description: "in seconds. Max 259200. Only to be used with SET and Lock OFF Mode"
        type: "uint32"
      3:
        name: "GSM ONOFF"
        description: "Currently only GET able. See Mode for altering behavior."
        type: "uint8"
        values:
          1:
            name: "ON"
          2:
            name: "OFF"
  32:
    name: "GSM IMEI"
    description: "GSM IMEI information"
    group: "device-services"
    data:
      1:
        name: "IMEI"
        description: "IMEI"
        type: "ascii"
  33:
    name: "GSM ICCID"
    description: "GSM ICCID information"
    group: "device-services"
    data:
      1:
        name: "ICCID"
        description: "ICCID"
        type: "ascii"
  34:
    name: "Device Status"
    description: "Device status information"
    group: "device-services"
    data:
      1:
        name: "Battery"
        description: "Battery level"
        type: "uint8"
      2:
        name: "Signal Strength"
        description: "Signal strength"
        type: "uint8"
      3:
        name: "Device Mode"
        description: "Device mode"
        type: "uint8"
  35:
    name: "Device ID"
    description: "Device ID information"
    group: "device-services"
    data:
      1:
        name: "ID"
        description: "ID"
        type: "uintn"
  36:
    name: "Device Time"
    description: "Device time information"
    group: "device-services"
    data:
      1:
        name: "Unix Time"
        description: "Unix time"
        type: "uint32"
      2:
        name: "Year"
        description: "Year"
        type: "uint16"
      3:
        name: "Month"
        description: "Month"
        type: "uint8"
      4:
        name: "Date"
        description: "Date"
        type: "uint8"
      5:
        name: "Weekday"
        description: "Weekday (1 monday etc)"
        type: "uint8"
      6:
        name: "Hour"
        description: "Hour"
        type: "uint8"
      7:
        name: "Minute"
        description: "Minute"
        type: "uint8"
      8:
        name: "Second"
        description: "Second"
        type: "uint8"
  39:
    name: "GPS Control"
    description: "Control the GPS of the device"
    group: "device-services"
    data:
      1:
        name: "GPS Enable"
        type: "uint8"
        values:
          0:
            name: "Disabled"
          1:
            name: "Enabled"
      2:
        name: "RTK Enable Correction"
        description: "Request correction data to be applied to the GPS"
        type: "uint8"
        values:
          0:
            name: "Disabled"
          1:
            name: "Enabled"
  40:
    name: "Haptics Control"
    description: "Control the haptics"
    group: "device-services"
    data:
      1:
        name: "Pattern"
        description: "Pattern of haptics [1-3]"
        type: "uint8"
      2:
        name: "Intensity"
        description: "Intensity of haptics [0-2], 0 = low, 1 = medium, 2 = high"
        type: "uint8"
  41:
    name: "Temperature"
    description: "Temperature information"
    group: "device-services"
    data:
      1:
        name: "Temperature"
        description: "Temperature in Celsius"
        type: "float32"
  42:
    name: "Buzzer Control"
    description: "Control the buzzer"
    group: "device-services"
    data:
      1:
        name: "Duration"
        description: "Duration of buzzer in milliseconds"
        type: "uint16"
      2:
        name: "Sound Type"
        description: "TBA"
        type: "uint8"
      3:
        name: "Intensity"
        description: "Intensity of buzzer"
        type: "uint8"
      4:
        name: "Run Count"
        description: "Number of times to run the buzzer"
        type: "uint8"
      5:
        name: "Frequency"
        description: "Frequency of buzzer of KHz.(if frequency is sent, only duration and frequency parameters will be inside the message)"
        type: "float32"
  43:
    name: "Battery Status"
    description: "Battery status information"
    group: "device-services"
    data:
      1:
        name: "Voltage"
        description: "Current battery voltage"
        type: "float32"
      2:
        name: "Percent"
        description: "Current battery percent"
        type: "uint8"
  44:
    name: "Pressure"
    description: "Pressure information"
    group: "device-services"
  45:
    name: "Alarm"
    description: "Trigger an alarm, using buzzer, haptics, and strobe"
    group: "device-services"
    data:
      1:
        name: "Legacy alarm action"
        description: "4 bytes of encoded data relating to legacy alarm formats. Can not be used with other options."
        type: "uint32"
      2:
        name: "Duration"
        description: "Duration of alarm in seconds. Max 127s"
        type: "uint8"
      3:
        name: "Buzzer Pattern"
        type: "uint8"
      4:
        name: "Buzzer Intensity"
        type: "uint8"
      5:
        name: "Haptics Pattern"
        type: "uint8"
      6:
        name: "Haptics Intensity"
        type: "uint8"
      7:
        name: "Strobe Pattern"
        type: "uint8"
      8:
        name: "Strobe Intensity"
        type: "uint8"
  50:
    name: "Link Control"
    description: "Control a link to the internet to send and receive messages"
    group: "device-services"
    data:
      # TODO add an options to give the link an ID, (or receive an ID from STM)
      1:
        name: "Link Address"
        description: "IP Address of the link"
        type: "ascii"
      2:
        name: "Link Port"
        type: "uint16"
      3:
        name: "Link Enable"
        type: "uint8"
        values:
          1:
            name: "Enable"
          2:
            name: "Disable"
      10:
        name: "Link ID"
        description: "ID of the link, for use with future commands, such as sending data"
        type: "uint8"
  51:
    name: "Link Data"
    description: "GET, SET or SUBSCRIBE to arbitrary data over a link."
    group: "device-services"
    data:
      1:
        name: "Identifier"
        description: "Identifier for the data, so it could be uniquely identified"
        type: "bytes"
      2:
        name: "Data"
        description: "Data to send over the link, can be up to 200 bytes"
        type: "bytes"
      3:
        name: "Checksum"
        description: "Checksum of the data. Can be used to verify the data integrity, or on GET on change etc."
        type: "bytes"
      # TODO Or do we want to use address and port every time?
      10:
        name: "Link ID"
        description: "ID of the link, for use with future commands, such as sending data"
        type: "uint8"
  1004:
    name: "LORA V4 Forwarding"
    description: "Forwarding LORA V4 message"
  # 10000:
  #   name: "Command Start"
  #   description: "Start UX command"
  #   group: "device-ux"
  10008:
    name: "Preset Page"
    description: "Display a predefined Lightbug page"
    group: "device-ux"
  10009:
    name: "Text Page"
    description: "Display or change a text page"
    group: "device-ux"
    data:
      3:
        name: "Page ID"
        description: "ID of page to display or update"
        type: "uintn"
      4:
        name: "Page Title"
        description: "Title of the page"
        type: "ascii"
      5:
        name: "Status bar"
        description: "Show the status bar"
        type: "uint8"
      100:
        name: "Line 1"
        type: "ascii"
      101:
        name: "Line 2"
        type: "ascii"
      102:
        name: "Line 3"
        type: "ascii"
      103:
        name: "Line 4"
        type: "ascii"
      104:
        name: "Line 5"
        type: "ascii"
  10010:
    name: "Menu Page"
    description: "Display or change a menu page"
    group: "device-ux"
    data:
      2:
        name: "Item count"
        type: "uint8"
      3:
        name: "Page ID"
        type: "uintn"
      4:
        name: "Page Title"
        type: "ascii"
      5:
        name: "Initial item selection"
        description: "An optional item to show as initially selected"
        type: "uint8"
      100:
        name: "Item 1"
        type: "ascii"
      101:
        name: "Item 2"
        type: "ascii"
      102:
        name: "Item 3"
        type: "ascii"
      103:
        name: "Item 4"
        type: "ascii"
      104:
        name: "Item 5"
        type: "ascii"
      105:
        name: "Item 6"
        type: "ascii"
      106:
        name: "Item 7"
        type: "ascii"
      107:
        name: "Item 8"
        type: "ascii"
      108:
        name: "Item 9"
        type: "ascii"
      109:
        name: "Item 10"
        type: "ascii"
      110:
        name: "Item 11"
        type: "ascii"
      111:
        name: "Item 12"
        type: "ascii"
      112:
        name: "Item 13"
        type: "ascii"
      113:
        name: "Item 14"
        type: "ascii"
      114:
        name: "Item 15"
        type: "ascii"
      115:
        name: "Item 16"
        type: "ascii"
      116:
        name: "Item 17"
        type: "ascii"
      117:
        name: "Item 18"
        type: "ascii"
      118:
        name: "Item 19"
        type: "ascii"
      119:
        name: "Item 20"
        type: "ascii"
  10011:
    name: "Draw Bitmap"
    description: "Draw bitmap in UX"
    group: "device-ux"
    data:
      3:
        name: "Page ID"
        type: "uintn"
      21:
        name: "Bitmap at X"
        type: "uintn"
      22:
        name: "Bitmap at Y"
        type: "uintn"
      23:
        name: "Bitmap width"
        type: "uintn"
      24:
        name: "Bitmap height"
        type: "uintn"
      25:
        name: "Bitmap data"
        type: "bytes"
      26:
        name: "Bitmap overlay"
        description: "Set if the previous page should NOT be cleared before drawing the bitmap"
        type: "uint8"
  10013:
    name: "Button Press"
    description: "Press UX button"
    group: "device-ux"
    data:
      3:
        name: "Page ID"
        type: "uintn"
      4:
        name: "Button ID"
        type: "uintn"
      5:
        name: "Selection ID"
        description: "Can be used if the button relates to something being selected on the page, such as in a menu"
        type: "uintn"
  10014:
    name: "Full Refresh"
    description: "Full refresh of UX"
    group: "device-ux"
  # 11000:
  #   name: "Command End"
  #   description: "End UX command"
  #   group: "device-ux"
